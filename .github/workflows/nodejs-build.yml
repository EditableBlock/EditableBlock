name: Node.js CI/CD Pipeline  # 工作流名

on:                           # 触发器，定义何时运行此工作流
  # push:
  #   branches: [master]        # 默认分支名!
  # pull_request:
  #   branches: [master]
  workflow_dispatch:          # 手动执行

jobs:
  build-app:                  # 作业 - NodeFlow App 构建部分
    runs-on: ubuntu-latest
    steps:
    - name: Env - Checkout
      uses: actions/checkout@v4
    - name: Checkout - 文档库1
      run: |
        git clone --depth 1 https://${{ secrets.EditableBlockRepo }}@github.com/LincZero/EditableBlock.git
      env:
        GH_TOKEN: ${{ secrets.VUEPRESSORG }}
    - name: Install pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 10.10.0
    - name: Env - Use Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22'
        cache: pnpm
    - name: Build
      run: |
        cd EditableBlock
        # pnpm app:build
        pnpm install --frozen-lockfile
        pnpm --dir ./src/App build
        touch ./src/App/dist/.nojekyll
        # cd ./src/App/
        # pnpm build
        # touch ./dist/.nojekyll
    - name: Build - Dist to Website Branch 1
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        # 这是文档部署到的分支名称
        branch: gh-pages
        folder: EditableBlock/src/App/dist
